<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <script src="https://unpkg.com/dayjs@1.11.10/dayjs.min.js"></script>
  </head>
  <body>
    <div id="report" v-cloak>
      <h1>Harvest Report</h1>
      <p>This page is a <i>mockup</i> of a simplified harvest report.</p>
      <label for="title">Title: </label>
        <input type="text" id="title" name="title" placeholder="My Sample Harvest Report" v-model="header">
      <br></br>
      <label for="start"><strong>Start:</strong></label>
      <input type="date" id="start" name="start" v-model="startDate" min="01/01/2014" :max="endDate" />
      <label for="start"><strong>End:</strong></label>
      <input type="date" id="end" name="end" v-model="endDate" :min="startDate" max="01/01/2022" />
      <br></br>
      <label for="crop"><strong>Crop:</strong></label>
      <select id="crop" name="crop" v-model="selectedCrop">
        <option v-for="crop in cropNames">{{ crop }}</option>
      </select>
      <label for="field"><strong>Area:</strong></label>
              <select id="field" name="field">
                  <option v-for="area in areas">{{ area }}</option>
              </select>
      <br></br>
      <button type="button" @click='addHarvest'>Generate Report</button>
      <hr></hr>
      <h1>{{ header ? header : 'Mock Harvest Report'}}</h1>
  
    <p>Details</p>
    <ul>
        <li v-model="farm"><strong>Farm:</strong>{{farm}}</li>
        <li v-model="user"><strong>User:</strong>{{user}}</li>
        <li v-model="language"><strong>Language:</strong>{{language}}</li>
        <br/>
        <li><strong>Start:</strong>{{startDate}}</li>
        <li><strong>End:</strong>{{endDate}}</li>
        <li><strong>Crop:</strong>{{selectedCrop}}</li>
    </ul>
    <div v-if="harvestList.length > 0">
    <table border="1">
        <tr>
          <td><strong>Row</strong></td>
          <td><strong>Date</strong></td>
          <td><strong>Area</strong></td>
          <td><strong>Crop</strong></td>
          <td><strong>Yield</strong></td>
          <td><strong>Units</strong></td>

        </tr>

        <tr v-for="(t,index) in harvestList">
          <td>{{ index + 1}}</td>
          <td>{{ t.date }}</td>
          <td>{{ t.area }}</td>
          <td> {{ t.crop }}</td>
          <td>{{ t.yield }}</td>
          <td>{{ t.units }}</td>
        </tr>
      </table>
    </div>
    </div>
      <script>
        var reportTitle = new Vue({
          el: '#report',
          created() {
            console.log("HarvestReport Vue instance created!")
            getIDToCropMap()
            .then((theMap) => {
                this.idToCropMap = theMap;
                console.log(this.idToCropMap);
            })
            .catch((err) => {
                console.log(err);
            })
          },
          data: {
            logs: [],
            idToCropMap: new Map(),
            farm: "",
            user: "",
            language: "",
            header: 'My Sample Harvest Report',
            startDate: '2020-05-05', 
            endDate: '2020-05-15', 
            selectedCrop: 'Kale',
            areas: [
              'All',
              'Chuau-1',
              'SQ7',
            ],
            table: [
              {date: "2018-05-02", area: "Chuau-1", crop: "Kale", yield: 10, units: "Bunches"},
              {date: "2018-05-05", area: "SQ7", crop: "Kale", yield: 7, units: "Bunches"},
            ],
            harvestList: []
          },
          computed: {
            cropNames() {
              return Array.from(this.idToCropMap.values())
            }
          },
          methods: {
            addHarvest: function() {
              const startTimestamp = dayjs(this.startDate).unix();
              const endTimestamp = dayjs(this.endDate).unix();

              console.log("Start Timestamp:", startTimestamp);
              console.log("End Timestamp:", endTimestamp);

              const requestString = `/log.json?type=farm_harvest&timestamp[ge]=${startTimestamp}&timestamp[le]=${endTimestamp}`;
              console.log(requestString);
              getAllPages(requestString, logs)
                .then(() => {
                    console.log("Harvest logs: ", logs);
                })
                .catch((err) => {
                    console.log(err);
                })
              axios.get('/farm.json')  
              .then((response) => {
                this.farm = response.data.name;
                this.user = response.data.user.name;
                this.language = response.data.languages.en.name;
                console.log("Got response");
                console.log(response);
              })
              .catch((error) => {
                console.log("Error occurred")
                console.log(error)
              })
              this.farm = "Sample Farm";
              this.user = "manager1";
              this.language = "English";
              this.harvestList.push({date: "2018-05-01", area: "Orion-3", crop: "Kale", yield: 12, units: "Bunches"});
            }
          }
        })
        Vue.config.devtools = true;
      </script>
  </body>
</html>